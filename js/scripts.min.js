(function($) {
    // Setup
    function init() {
        $("html").removeClass("no-js");
        assignEventHandlers();
    }

    // event handlers
    function assignEventHandlers() {
        $("header a").click(handleHeaderNavigation);
        $("#to-top").click(scrollToTop);
        $("#lead-down span").click(scrollToNextSection);
        $("#experience-timeline").each(setupTimeline); 
        $("#view-more-projects").click(showMoreProjects);
    }

    // Handle nav in the page header
    function handleHeaderNavigation(e) {
        if (!$(this).hasClass("no-scroll")) {
            e.preventDefault();
            var targetId = $(this).attr("href"),
                targetElement = $(targetId);
            
            if (targetElement.length) {
                window.scrollTo({
                    top: targetElement.offset().top,
                    behavior: 'smooth'
                });
                
                if ($("header").hasClass("active")) {
                    $("header, body").removeClass("active");
                }
            }
        }
    }

    // scroll to top of the page
    function scrollToTop() {
        window.scrollTo({
            top: 0,
            behavior: 'smooth'
        });
    }

    // scroll to the next section of the lead
    function scrollToNextSection() {
        var nextSection = $("#lead").next();
        if (nextSection.length) {
            window.scrollTo({
                top: nextSection.offset().top,
                behavior: 'smooth'
            });
        }
    }

    // set up experience timeline
    function setupTimeline() {
        var $this = $(this),
            $userContent = $this.children("div");
        
        $userContent.addClass("vtimeline-content").wrap('<div class="vtimeline-point"><div class="vtimeline-block"></div></div>');

        $this.find(".vtimeline-point").prepend('<div class="vtimeline-icon"><i class="fas fa-location-dot"></i></div>'); // changed to new FA

        $this.find(".vtimeline-content").each(function() {
            var date = $(this).data("date");
            if (date) {
                $(this).parent().prepend('<span class="vtimeline-date">' + date + '</span>');
            }
        });
    }

    // show more projects in the portfolio
    function showMoreProjects(e) {
        e.preventDefault();
        $(this).fadeOut(300, function() {
            $("#more-projects").fadeIn(300);
        });
    }

    // Initialize
    init();
})(jQuery);
