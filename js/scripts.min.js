(function($) {
    // Initial Setup
    function init() {
        $("html").removeClass("no-js");
        assignEventHandlers();
    }

    // Assigning event handlers
    function assignEventHandlers() {
        $("header a").click(handleHeaderNavigation);
        $("#to-top").click(scrollToTop);
        $("#lead-down span").click(scrollToNextSection);
        $("#experience-timeline").each(setupTimeline);
        $("#mobile-menu-open").click(openMobileMenu);
        $("#mobile-menu-close").click(closeMobileMenu);
        $("#view-more-projects").click(showMoreProjects);
    }

    // Handle navigation within the page header
    function handleHeaderNavigation(e) {
        if (!$(this).hasClass("no-scroll")) {
            e.preventDefault();
            var targetId = $(this).attr("href"),
                targetOffset = $(targetId).offset().top,
                distance = Math.abs(window.pageYOffset - targetOffset);
            $("html, body").animate({ scrollTop: targetOffset + "px" }, distance);
            if ($("header").hasClass("active")) {
                $("header, body").removeClass("active");
            }
        }
    }

    // Scroll to top of the page
    function scrollToTop() {
        $("html, body").animate({ scrollTop: 0 }, 500);
    }

    // Scroll to the next section from the lead
    function scrollToNextSection() {
        var nextSectionTop = $("#lead").next().offset().top;
        $("html, body").animate({ scrollTop: nextSectionTop + "px" }, 500);
    }

    // Set up the experience timeline
    function setupTimeline() {
        var $this = $(this),
            $userContent = $this.children("div");
        
        $userContent.addClass("vtimeline-content").wrap('<div class="vtimeline-point"><div class="vtimeline-block"></div></div>');

        $this.find(".vtimeline-point").prepend('<div class="vtimeline-icon"><i class="fa fa-map-marker"></i></div>');

        $this.find(".vtimeline-content").each(function() {
            var date = $(this).data("date");
            if (date) {
                $(this).parent().prepend('<span class="vtimeline-date">' + date + '</span>');
            }
        });
    }

    // Open the mobile menu
    function openMobileMenu() {
        $("header, body").addClass("active");
    }

    // Close the mobile menu
    function closeMobileMenu() {
        $("header, body").removeClass("active");
    }

    // Show more projects in the portfolio
    function showMoreProjects(e) {
        e.preventDefault();
        $(this).fadeOut(300, function() {
            $("#more-projects").fadeIn(300);
        });
    }

    // Initialize the script
    init();
})(jQuery);
